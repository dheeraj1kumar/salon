{%extends 'base.html' %}
{%load static %}
{% block css %}
<style>
    .hero {
    display: flex;
    align-items: center;
    min-height: 100vh;
    padding: 120px 20px 50px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.hero-content {
    flex: 1;
    max-width: 600px;
    margin-right: 2rem;
}

.hero-content h1 {
    font-size: 3.5rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 1rem;
    line-height: 1.2;
}

.hero-content p {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 2rem;
    line-height: 1.6;
}

.cta-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    text-decoration: none;
}

.cta-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.hero-image {
    flex: 1;
    text-align: center;
}

.hero-image img {
    max-width: 100%;
    height: auto;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}


.services {
    padding: 100px 0;
    background: white;
}

.section-title {
    text-align: center;
    font-size: 2.5rem;
    color: #333;
    margin-bottom: 3rem;
    position: relative;
}

.section-title::after {
    content: '';
    position: absolute;
    width: 100px;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 2px;
}

.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.service-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 25px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
}

.service-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.service-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.service-info {
    padding: 1.5rem;
}

.service-info h3 {
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 0.5rem;
}

.service-info p {
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.5;
}

.price {
    font-size: 1.2rem;
    font-weight: 700;
    color: #667eea;
    display: block;
    margin-bottom: 1rem;
}
.book-btn.is-added{
  background:#559856;
  color:white;
  cursor:not-allowed;
}
.book-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    width: 100%;
}

.book-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}


.contact {
    padding: 100px 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.contact-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    margin-top: 3rem;
}

.contact-info {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.info-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.info-item i {
    font-size: 1.5rem;
    color: #667eea;
    margin-top: 5px;
}

.info-item h3 {
    color: #333;
    margin-bottom: 0.5rem;
}

.info-item p {
    color: #666;
    line-height: 1.5;
}

.contact-form {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.contact-form h3 {
    color: #333;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.contact-form input,
.contact-form textarea {
    width: 100%;
    padding: 1rem;
    border: 2px solid #f0f0f0;
    border-radius: 10px;
    margin-bottom: 1rem;
    font-family: inherit;
    transition: border-color 0.3s ease;
}

.contact-form input:focus,
.contact-form textarea:focus {
    outline: none;
    border-color: #667eea;
}

.contact-form button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    width: 100%;
}

.contact-form button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}
</style>
{% endblock %}
{% block content %}
<main>

    <section id="home" class="hero">
        <div class="hero-content">
            <h1>Elevate Your Presence</h1>
            <p>Step into Royal Barber, where grooming meets sophistication. Our master barbers craft tailored styles that exude confidence, class, and timeless elegance.</p>
            <a href="#services" class="cta-button">Book Now</a>
        </div>
        <div class="hero-image">
            <img src="/media/services/banner.jpg" alt="Salon Interior">
        </div>
    </section>
    
    
    <section id="services" class="services">
        <div class="container">
          <h2 class="section-title">Our Services</h2>
          <div class="services-grid">
            {% for service in services %}
              <div class="service-card" data-service-id="{{ service.id }}">
                {% if service.image %}
  <img src="{{ service.image }}" alt="{{ service.name }}">
{% else %}
  <img src="{% static 'images/default.jpeg' %}" alt="{{ service.name }}">
{% endif %}

                <div class="service-info">
                  <h3>{{ service.name }}</h3>
                  <p>{{ service.description }}</p>
                  <div><p>{{ service.formatted_duration }}</p></div>
                  <span class="price">Rs.{{ service.price }}</span>
      
                  {% if user.is_authenticated and service.id in cart_ids %}
                    <button class="book-btn is-added" data-id="{{ service.id }}" disabled>Added</button>
                  {% else %}
                    <button class="book-btn" data-id="{{ service.id }}">Add to Cart</button>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </section>
      


    <section id="contact" class="contact">
        <div class="container">
            <h2 class="section-title">Contact Us</h2>
            <div class="contact-content">
                <div class="contact-info">
                    <div class="info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <h3>Address</h3>
                            <p>Window Cyber Park, Noida-sector 58<br>UttarPradesh, 201301</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <h3>Phone</h3>
                            <p>+91-9898XXXXXX</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <h3>Email</h3>
                            <p>info@royalbarber.com</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <h3>Opening Hours</h3>
                            <p>Monday - Sunday<br> 10:00 AM - 9:00 PM</p>
                        </div>
                    </div>
                </div>
                <form class="contact-form" id="contact-form">
                    <h3>Send us a message</h3>
                    <input type="text" placeholder="Your Name" required>
                    <input type="email" placeholder="Your Email" required>
                    <input type="tel" placeholder="Your Phone">
                    <textarea placeholder="Your Message" rows="5" required></textarea>
                    <button type="submit">Send Message</button>
                </form>
            </div>
        </div>
    </section>
</main>
{%endblock%}
{% block js %}

<script>
    (function(){
      
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
      const csrftoken = getCookie("csrftoken");
      
      
      function toast(msg, type = "info") {
        const colors = {
            success: "#16a34a", // green
            error:   "#dc2626", // red
            warning: "#d97706", // amber
            info:    "#111111"  // dark
        };

        let el = document.createElement("div");
        el.textContent = msg;
        el.style.cssText = `
            position:fixed;
            left:50%;
            top:90px;
            transform:translateX(-50%);
            background:${colors[type] || colors.info};
            color:#fff;
            padding:10px 14px;
            border-radius:8px;
            z-index:9999;
            box-shadow:0 6px 20px rgba(0,0,0,.25);
        opacity:1;`;
        document.body.appendChild(el);

        setTimeout(() => { el.style.transition = "opacity .3s"; el.style.opacity = "0"; }, 1300);
        setTimeout(() => el.remove(), 1700);
    } 

    
      document.querySelectorAll(".book-btn").forEach(btn => {
        btn.addEventListener("click", async function() {
          if (btn.disabled) return;
          const serviceId = btn.getAttribute("data-id");
    
          try {
            const res = await fetch(`/cart/add/${serviceId}/`, {
              method: "POST",
              headers: { "X-CSRFToken": csrftoken, "X-Requested-With":"XMLHttpRequest" },
            });
    
            if (res.status === 401) {
              
              toast("Please log in to add items.","warning");
              document.getElementById("login-btn")?.click();
              return;
            }
    
            const data = await res.json();
    
            if (data.success) {
              
              btn.textContent = "Added";
              btn.classList.add("is-added");
              btn.disabled = true;
    
              
              if (typeof updateCartBadge === "function" && data.cart_count !== undefined) {
                updateCartBadge(data.cart_count);
              }
    
              toast(data.message || "Added to cart","success");
            } else {
              toast(data.error || "Could not add to cart","error");
            }
          } catch (e) {
            toast("Network error. Try again.","error");
          }
        });
      });
    })();
    </script>
    <script>
        (function () {
          const form = document.getElementById('contact-form');
          if (!form) return;
        
         
          function ensureBanner() {
            let banner = form.querySelector('.contact-banner');
            if (!banner) {
              banner = document.createElement('div');
              banner.className = 'contact-banner';
              form.prepend(banner);
            }
            return banner;
          }
          function showBanner(type, text) {
            const banner = ensureBanner();
            banner.textContent = text;
            banner.className = `contact-banner ${type}`; 
          }
        
       
          function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
          }
        
          
          const nameInput    = form.querySelector('input[name="name"]')    || form.querySelector('input[type="text"]');
          const emailInput   = form.querySelector('input[name="email"]')   || form.querySelector('input[type="email"]');
          const phoneInput   = form.querySelector('input[name="phone"]')   || form.querySelector('input[type="tel"]');
          const messageInput = form.querySelector('textarea[name="message"]') || form.querySelector('textarea');
        
          
          function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
              const cookies = document.cookie.split(";");
              for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + "=")) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
                }
              }
            }
            return cookieValue;
          }
          let csrf = getCookie("csrftoken");
          if (!csrf) {
            const csrfInput = document.querySelector('input[name=csrfmiddlewaretoken]');
            if (csrfInput) csrf = csrfInput.value;
          }
        
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
        
            const name = (nameInput?.value || "").trim();
            const email = (emailInput?.value || "").trim();
            const phone = (phoneInput?.value || "").trim();
            const message = (messageInput?.value || "").trim();
        
            
            if (!name) { showBanner('error', 'Please enter your name.'); nameInput?.focus(); return; }
            if (!email || !isValidEmail(email)) { showBanner('error', 'Please enter a valid email address.'); emailInput?.focus(); return; }
            if (!message) { showBanner('error', 'Please enter your message.'); messageInput?.focus(); return; }
        
            
            const url = '/contact';
        
            const submitBtn = form.querySelector('button[type=submit]');
            const originalText = submitBtn ? submitBtn.textContent : '';
            if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Sending...'; }
        
            try {
              const res = await fetch(url, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  ...(csrf ? { 'X-CSRFToken': csrf } : {}),
                  'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({ name, email, phone, message })
              });
        
              
              if (res.status === 401) {
                toast('Please log in to contact.','warning');
                
                document.getElementById("login-btn")?.click();
                return;
              }
        
              if (!res.ok) {
                let errText = 'Failed to send message. Please try again.';
                try {
                  const errData = await res.json();
                  if (errData && (errData.error || errData.detail)) {
                    errText = errData.error || errData.detail;
                  }
                } catch (_) {}
                showBanner('error', errText);
                return;
              }
        
              const data = await res.json().catch(() => ({}));
              if (data && data.success !== false) {
                showBanner('success', 'Your message has been sent. We will get back to you soon.');
                form.reset();
              } else {
                showBanner('error', (data && data.error) || 'Failed to send message. Please try again.');
              }
            } catch (err) {
              showBanner('error', 'Network error. Please check your connection and try again.');
            } finally {
              if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = originalText; }
            }
          });
        })();
        </script>
        
{%endblock%}